>>> FOLDERS >>>
‚îú‚îÄ‚îÄ navigation
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ api_stub.py
‚îÇ   ‚îú‚îÄ‚îÄ engine.py
‚îÇ   ‚îú‚îÄ‚îÄ logger.py
‚îÇ   ‚îú‚îÄ‚îÄ manifest.py
‚îÇ   ‚îî‚îÄ‚îÄ textual_ui.py
‚îú‚îÄ‚îÄ dumper.py
‚îú‚îÄ‚îÄ makedump.json
‚îî‚îÄ‚îÄ menu-manifest.json
>>> FILES >>>
dumper.py
---
import os
import json
import fnmatch
import sys
import base64
from pathlib import Path

def load_config(config_path=None):
    """–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ JSON —Ñ–∞–π–ª–∞"""
    if config_path is None:
        config_path = "makedump.json"
    
    with open(config_path, 'r', encoding='utf-8') as f:
        return json.load(f)

def should_include(name, include_patterns, exclude_patterns):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ–ª–∂–µ–Ω –ª–∏ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω —Ñ–∞–π–ª/–ø–∞–ø–∫–∞ –ø–æ —à–∞–±–ª–æ–Ω–∞–º"""
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
    for exclude in exclude_patterns:
        if fnmatch.fnmatch(name, exclude):
            return False
    
    # –ï—Å–ª–∏ –Ω–µ—Ç —è–≤–Ω—ã—Ö –≤–∫–ª—é—á–µ–Ω–∏–π, –≤–∫–ª—é—á–∞–µ–º –≤—Å—ë
    if not include_patterns:
        return True
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏–π
    for include in include_patterns:
        if fnmatch.fnmatch(name, include):
            return True
    
    return False

def get_tree_structure(root_dir, file_include_patterns, file_exclude_patterns, folder_exclude_patterns, prefix=""):
    """–†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å—Ç—Ä–æ–∏—Ç –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —Ñ–∞–π–ª–æ–≤"""
    result = []
    try:
        items = sorted(os.listdir(root_dir))
    except PermissionError:
        return result
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º –ø–∞–ø–∫–∏ - –∏—Å–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ folder_exclude_patterns
    dirs = [item for item in items 
            if os.path.isdir(os.path.join(root_dir, item)) 
            and should_include(item, ["*"], folder_exclude_patterns)]
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º —Ñ–∞–π–ª—ã - –ø–æ file_include_patterns –∏ file_exclude_patterns
    files = [item for item in items 
             if not os.path.isdir(os.path.join(root_dir, item)) 
             and should_include(item, file_include_patterns, file_exclude_patterns)]
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–∞–ø–∫–∏, –ø–æ—Ç–æ–º —Ñ–∞–π–ª—ã
    items = dirs + files
    
    pointers = ["‚îú‚îÄ‚îÄ "] * (len(items) - 1) + ["‚îî‚îÄ‚îÄ "]
    
    for pointer, item in zip(pointers, items):
        path = os.path.join(root_dir, item)
        rel_path = os.path.relpath(path, Path(root_dir).parent)
        
        result.append(f"{prefix}{pointer}{item}")
        
        if os.path.isdir(path):
            extension = "‚îÇ   " if pointer == "‚îú‚îÄ‚îÄ " else "    "
            result.extend(get_tree_structure(
                path, 
                file_include_patterns, 
                file_exclude_patterns, 
                folder_exclude_patterns, 
                prefix + extension
            ))
    
    return result

def dump_folders(config, output_file):
    """–î–∞–º–ø —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫"""
    print(">>> FOLDERS >>>", file=output_file)
    
    for source in config['folders']['sources']:
        root = source['root']
        if root == ".":
            root = os.getcwd()
        
        # –î–ª—è –ø–∞–ø–æ–∫: –≤–∫–ª—é—á–∞–µ–º –í–°–ï –ø–∞–ø–∫–∏ (–∫—Ä–æ–º–µ –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã—Ö), –Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ–º —Ñ–∞–π–ª—ã –ø–æ —à–∞–±–ª–æ–Ω–∞–º
        file_include = source.get('include', [])
        file_exclude = source.get('exclude', [])
        folder_exclude = source.get('exclude', [])  # –î–ª—è –ø–∞–ø–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ exclude
        
        output_template = config['folders']['output']
        
        # –ï—Å–ª–∏ —à–∞–±–ª–æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        if "‚îú‚îÄ‚îÄ" in output_template or "‚îî‚îÄ‚îÄ" in output_template:
            tree_lines = get_tree_structure(root, file_include, file_exclude, folder_exclude)
            for line in tree_lines:
                print(line, file=output_file)
        else:
            # –û–±—ã—á–Ω—ã–π –≤—ã–≤–æ–¥ –ø–ª–æ—Å–∫–æ–≥–æ —Å–ø–∏—Å–∫–∞
            for dirpath, dirnames, filenames in os.walk(root):
                # –§–∏–ª—å—Ç—Ä—É–µ–º –ø–∞–ø–∫–∏
                dirnames[:] = [d for d in dirnames if should_include(d, ["*"], folder_exclude)]
                
                for dirname in dirnames:
                    full_path = os.path.join(dirpath, dirname)
                    rel_path = os.path.relpath(full_path, root)
                    
                    output_line = output_template
                    if "@.name" in output_line:
                        output_line = output_line.replace('@.name', dirname)
                    if "@.path" in output_line:
                        output_line = output_line.replace('@.path', rel_path)
                    print(output_line, file=output_file)

def dump_files(config, output_file):
    """–î–∞–º–ø —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–æ–≤"""
    print(">>> FILES >>>", file=output_file)
    
    for source in config['files']['sources']:
        root = source['root']
        if root == ".":
            root = os.getcwd()
        
        include = source['include']
        exclude = source['exclude']
        
        for dirpath, dirnames, filenames in os.walk(root):
            for filename in filenames:
                if should_include(filename, include, exclude):
                    file_path = os.path.join(dirpath, filename)
                    rel_path = os.path.relpath(file_path, root)
                    
                    try:
                        # –ü—Ä–æ–±—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–∞–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
                        with open(file_path, 'r', encoding='utf-8') as f:
                            content = f.read()
                    except UnicodeDecodeError:
                        # –ï—Å–ª–∏ –Ω–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π, —á–∏—Ç–∞–µ–º –∫–∞–∫ –±–∏–Ω–∞—Ä–Ω—ã–π –∏ –∫–æ–¥–∏—Ä—É–µ–º –≤ base64
                        with open(file_path, 'rb') as f:
                            content = base64.b64encode(f.read()).decode('ascii')
                    
                    output = config['files']['output']
                    output = output.replace('@.name', rel_path)
                    output = output.replace('@.data', content)
                    print(output, file=output_file)

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    # –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
    config_path = None
    output_path = "output.txt"
    
    for arg in sys.argv[1:]:
        if arg.endswith('.json'):
            config_path = arg
        else:
            output_path = arg
    
    config = load_config(config_path)
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    os.makedirs(os.path.dirname(output_path) if os.path.dirname(output_path) else '.', exist_ok=True)
    
    with open(output_path, 'w', encoding='utf-8') as output_file:
        dump_folders(config, output_file)
        dump_files(config, output_file)
    
    print(f"–î–∞–º–ø —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: {output_path}")

if __name__ == "__main__":
    main()
makedump.json
---
{
  "folders": {
    "sources": [
      {
        "root": ".",
        "include": ["*.py", "*.json"],
        "exclude": [".git", ".py*", "__py*"]
      }
    ],
    "output": "‚îú‚îÄ‚îÄ @.path"
  },
  "files": {
    "sources": [
      {
        "root": ".",
        "include": ["*.py","*.json"],
        "exclude": []
      }
    ],
    "output": "@.name\n---\n@.data"
  }
}
menu-manifest.json
---
{
  "defaults": {
    "back_button_label": "< –ù–∞–∑–∞–¥",
    "chat_mode": {
      "finish_commands": ["/finish", "/start"],
      "finish_button_label": "–ó–∞–∫–æ–Ω—á–∏—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä"
    },
    "pagination": {
      "page_size": 8,
      "prev_label": "<<",
      "next_label": ">>"
    }
  },
  "screens": {
    "main": {
      "title": "–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é",
      "type": "static",
      "buttons": [
        { "label": "–ú–æ–∏ —Ç—Ä–µ–∫–∏", "target": "tracks" },
        { "label": "–ü–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–º–µ—Ç–∫–∏", "target": "quick_grade" },
        { "label": "–ë–ª–∏–∂–∞–π—à–∏–µ –≤—Å—Ç—Ä–µ—á–∏", "target": "meetings" },
        { "label": "–†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Ä–µ–∂–∏–º", "target": "chat_mode" },
        { "label": "–ú–æ–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è...", "target": "prefs" },
        { "label": "–ü–æ–º–æ—â—å –æ—Ç –ò–ò", "target": "ai_help" },
        { "label": "–¢–µ—Å—Ç: –ê–ª—Ñ–∞–≤–∏—Ç", "target": "alphabet" }
      ]
    },
    "tracks": {
      "title": "–í–∞—à–∏ –∫—É—Ä—Å—ã (—Ç—Ä–µ–∫–∏)",
      "type": "dynamic",
      "data_source": {
        "url": "/api/teacher/tracks",
        "method": "GET"
      },
      "button_template": {
        "label_field": "name",
        "target_screen": "track_detail",
        "context_fields": {
          "track_id": "id",
          "track_name": "name"
        }
      },
      "back_path": "main"
    },
    "track_detail": {
      "title": "–¢—Ä–µ–∫: {{track_name}}",
      "type": "static",
      "buttons": [
        { "label": "–ù–∞—Å—Ç—Ä–æ–π–∫–∞", "target": "track_settings" },
        { "label": "–°—Ç—É–¥–µ–Ω—Ç—ã", "target": "track_students" }
      ],
      "back_path": "tracks"
    },
    "track_settings": {
      "title": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–µ–∫–∞ ¬´{{track_name}}¬ª",
      "type": "static",
      "buttons": [
        { "label": "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ", "action": "edit_name" },
        { "label": "–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞—Ç—ã", "target": "track_dates" }
      ],
      "back_path": "track_detail"
    },
    "track_dates": {
      "title": "–î–∞—Ç—ã –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è",
      "type": "static",
      "buttons": [
        { "label": "–°–æ–±—ã—Ç–∏—è", "target": "track_events" }
      ],
      "back_path": "track_settings"
    },
    "track_events": {
      "title": "–°–æ–±—ã—Ç–∏—è –≤ —Ç—Ä–µ–∫–µ",
      "type": "static",
      "buttons": [
        { "label": "–î–æ–±–∞–≤–∏—Ç—å –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é", "action": "add_recurring_event" },
        { "label": "–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ", "action": "add_one_time_event" }
      ],
      "back_path": "track_dates"
    },
    "track_students": {
      "title": "–°—Ç—É–¥–µ–Ω—Ç—ã –≤ —Ç—Ä–µ–∫–µ ¬´{{track_name}}¬ª",
      "type": "dynamic",
      "data_source": {
        "url": "/api/tracks/{{track_id}}/students",
        "method": "GET"
      },
      "button_template": {
        "label_field": "full_name",
        "target_screen": "student_profile",
        "context_fields": {
          "student_id": "id",
          "student_name": "full_name"
        }
      },
      "back_path": "track_detail"
    },
    "student_profile": {
      "title": "–°—Ç—É–¥–µ–Ω—Ç: {{student_name}}",
      "type": "static",
      "buttons": [
        { "label": "–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å", "action": "open_full_profile" },
        { "label": "–ü–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–º–µ—Ç–∫—É", "target": "select_metric" }
      ],
      "back_path": "track_students"
    },
    "select_metric": {
      "title": "–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç—Ä–∏–∫—É –¥–ª—è {{student_name}}",
      "type": "dynamic",
      "layout": "grid",
      "columns": 3,
      "supports_multi_select": false,
      "data_source": {
        "url": "/api/metrics",
        "method": "GET"
      },
      "button_template": {
        "label_field": "name",
        "target_screen": "confirm_mark",
        "context_fields": {
          "metric_id": "id",
          "metric_name": "name"
        }
      },
      "back_path": "CONTEXTUAL"
    },
    "confirm_mark": {
      "title": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ: –æ—Ç–º–µ—Ç–∏—Ç—å {{student_name}} –ø–æ –º–µ—Ç—Ä–∏–∫–µ ¬´{{metric_name}}¬ª?",
      "type": "static",
      "buttons": [
        { "label": "–î–∞", "action": "submit_mark", "payload": "true" },
        { "label": "–ù–µ—Ç", "target": "select_metric" }
      ],
      "back_path": "select_metric"
    },
    "alphabet": {
      "title": "–í—ã–±–µ—Ä–∏—Ç–µ –±—É–∫–≤—É —Ñ–∞–º–∏–ª–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞",
      "type": "static",
      "paginated": true,
      "supports_multi_select": false,
      "items": ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],
      "back_path": "main"
    },
    "chat_mode": {
      "title": "–í—ã –≤–æ—à–ª–∏ –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Ä–µ–∂–∏–º. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –æ–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é.",
      "type": "chat_input",
      "back_path": "main",
      "ai_api": {
        "url": "/api/ai/teacher-assist",
        "method": "POST",
        "body_template": {
          "user_id": "{{user_id}}",
          "context": "{{chat_history}}",
          "query": "{{user_message}}"
        }
      }
    },
    "ai_help": {
      "title": "–û–ø–∏—à–∏—Ç–µ, –≤ —á—ë–º –≤–∞–º –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´–ö–∞–∫ –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å—Ç–∞—é—â–µ–≥–æ?¬ª)",
      "type": "chat_input",
      "back_path": "main",
      "ai_api": {
        "url": "/api/ai/help",
        "method": "POST",
        "body_template": {
          "user_role": "teacher",
          "request": "{{user_message}}"
        }
      }
    },
    "quick_grade": {
      "title": "–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä: –¥–ª—è –∫–æ–≥–æ —Å—Ç–∞–≤–∏–º –æ—Ç–º–µ—Ç–∫—É?",
      "type": "dynamic",
      "data_source": {
        "url": "/api/teacher/recent_students",
        "method": "GET"
      },
      "button_template": {
        "label_field": "full_name",
        "target_screen": "select_metric",
        "context_fields": {
          "student_id": "id",
          "student_name": "full_name"
        }
      },
      "back_path": "main"
    }
  }
}
navigation\api_stub.py
---
# navigation/api_stub.py
from typing import Any, Dict, List
import json

class APISimulator:
    """
    –£–º–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API.
    –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å: –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å –∫–ª—é—á –≤ MOCK_DATA.
    –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ ‚Äî –∑–∞–º–µ–Ω–∏ –Ω–∞ requests/aiohttp.
    """
    MOCK_DATA = {
        "/api/teacher/tracks": [
            {"id": "game-design", "name": "–ì–µ–π–º–¥–∏–∑–∞–π–Ω"},
            {"id": "architecture", "name": "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"},
        ],
        "/api/metrics": [
            {"id": "creative", "name": "–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å"},
            {"id": "result", "name": "–†–µ–∑—É–ª—å—Ç–∞—Ç"},
            {"id": "teamwork", "name": "–†–∞–±–æ—Ç–∞ –≤ –∫–æ–º–∞–Ω–¥–µ"},
            {"id": "initiative", "name": "–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å"},
            {"id": "discipline", "name": "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞"},
            {"id": "communication", "name": "–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è"},
            {"id": "problem_solving", "name": "–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º"},
            {"id": "leadership", "name": "–õ–∏–¥–µ—Ä—Å—Ç–≤–æ"},
            {"id": "adaptability", "name": "–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å"},
            {"id": "accuracy", "name": "–¢–æ—á–Ω–æ—Å—Ç—å"},
            {"id": "persistence", "name": "–ù–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å"},
            {"id": "ethics", "name": "–≠—Ç–∏—á–Ω–æ—Å—Ç—å"},
        ],
        "/api/tracks/game-design/students": [
            {"id": "ivanov", "full_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω"},
            {"id": "petrov", "full_name": "–ü–µ—Ç—Ä–æ–≤ –ü—ë—Ç—Ä"},
        ],
        "/api/tracks/architecture/students": [
            {"id": "sidorov", "full_name": "–°–∏–¥–æ—Ä–æ–≤ –°–∏–¥–æ—Ä"},
        ],
        "/api/teacher/recent_students": [
            {"id": "ivanov", "full_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω"},
            {"id": "sidorov", "full_name": "–°–∏–¥–æ—Ä–æ–≤ –°–∏–¥–æ—Ä"},
        ]
    }

    def call(self, url: str, method: str = "GET", **kwargs) -> List[Dict[str, Any]]:
        """
        –ò–º–∏—Ç–∏—Ä—É–µ—Ç API-–≤—ã–∑–æ–≤.
        :param url: –ø—É—Ç—å (–º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —à–∞–±–ª–æ–Ω—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä /api/tracks/{{track_id}}/students)
        :param method: HTTP-–º–µ—Ç–æ–¥ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –∑–∞–≥–ª—É—à–∫–µ)
        :return: —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
        """
        # üî• –û–ü–ê–°–ù–û–ï –ú–ï–°–¢–û: –µ—Å–ª–∏ URL –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî —É–ø–∞–¥—ë–º!
        # –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ: –æ–±–µ—Ä–Ω–∏ –≤ try/except –∏ –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –æ—à–∏–±–∫—É
        if url in self.MOCK_DATA:
            return self.MOCK_DATA[url]
        
        # –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ "–ø–æ —à–∞–±–ª–æ–Ω—É" (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)
        # –ù–∞–ø—Ä–∏–º–µ—Ä: /api/tracks/game-design/students ‚Üí –∏—â–µ–º –ø–æ –±–∞–∑–æ–≤–æ–º—É –ø—É—Ç–∏
        for key in self.MOCK_DATA:
            if key.startswith("/api/tracks/") and key.endswith("/students"):
                if url.startswith("/api/tracks/") and url.endswith("/students"):
                    return self.MOCK_DATA[key]  # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥—è—â–∏–π

        # –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Äî –ª–æ–≥–≥–∏—Ä—É–µ–º –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
        return []
navigation\engine.py
---
import copy
import time
from typing import Any, Dict, List, Optional, Union
from .logger import NavigationLogger
from .api_stub import APISimulator
from .manifest import ManifestLoader

class NavigationEngine:
    def __init__(
        self,
        manifest_path: str = "menu-manifest.json",
        logger: Optional[NavigationLogger] = None,
        api_client: Optional[Any] = None
    ):
        self.manifest = ManifestLoader(manifest_path)
        self.logger = logger or NavigationLogger()
        self.api_client = api_client or APISimulator()
        self._user_states: Dict[str, Dict[str, Any]] = {}

    def init_user(self, user_id: str):
        self._user_states[user_id] = {
            "current_screen": "main",
            "context": {"user_id": user_id},
            "return_stack": [],
            "pagination": {},
            "selections": [] # <-- –ù–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–±–æ—Ä–æ–≤
        }
        self.logger.log_view_rendered(user_id, "main", "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è")

    def get_user_state(self, user_id: str) -> Dict[str, Any]:
        if user_id not in self._user_states:
            self.init_user(user_id)
        return self._user_states[user_id]

    def get_current_view(self, user_id: str) -> Dict[str, Any]:
        state = self.get_user_state(user_id)
        screen_id = state["current_screen"]
        screen_def = self.manifest.screens.get(screen_id)

        if not screen_def:
            self.logger.log_error(f"–≠–∫—Ä–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω: {screen_id}")
            return {
                "text": "–û—à–∏–±–∫–∞: —ç–∫—Ä–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω",
                "actions": [{"id": "back", "label": "< –ù–∞–∑–∞–¥", "type": "back"}],
                "screen_type": "error"
            }

        title = self._render_template(screen_def["title"], state["context"])

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Ç–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø
        if screen_def["type"] == "chat_input":
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—Å—Ç –∏ —Ç–∏–ø, –Ω–æ –±–µ–∑ –∫–Ω–æ–ø–æ–∫
            # GUI –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å Input –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã
            self.logger.log_view_rendered(user_id, screen_id, title)
            return {"text": title, "actions": [], "screen_type": "chat_input"}

        if screen_def["type"] == "dynamic":
            actions = self._build_dynamic_actions(user_id, screen_def, state["context"])
        elif screen_def.get("paginated"):
            actions = self._build_paginated_actions(user_id, screen_def, state["context"])
        else:
            actions = self._build_static_actions(screen_def)

        back_path = screen_def.get("back_path")
        if back_path:
            back_label = screen_def.get("back_label", self.manifest.defaults["back_button_label"])
            actions.append({"id": "back", "label": back_label, "type": "back"})

        self.logger.log_view_rendered(user_id, screen_id, title)
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ layout, –µ—Å–ª–∏ –µ—Å—Ç—å
        view_data = {"text": title, "actions": actions, "screen_type": screen_def["type"]}
        if screen_def.get("layout") == "grid":
            view_data["layout"] = "grid"
            view_data["columns"] = screen_def.get("columns", 1)
        return view_data

    def _render_template(self, template: str, context: Dict[str, Any]) -> str:
        result = template
        for key, value in context.items():
            result = result.replace(f"{{{{{key}}}}}", str(value))
        return result

    def _record_selection(self, user_id: str, screen_id: str, selected_item: Dict[str, Any]):
        """
        –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        –ï—Å–ª–∏ —ç–∫—Ä–∞–Ω –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º—É–ª—å—Ç–∏–≤—ã–±–æ—Ä, —É–¥–∞–ª—è–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤—ã–±–æ—Ä—ã –Ω–∞ —ç—Ç–æ–º —ç–∫—Ä–∞–Ω–µ.
        """
        state = self.get_user_state(user_id)
        screen_def = self.manifest.screens.get(screen_id)
        supports_multi = screen_def.get("supports_multi_select", False)

        if not supports_multi:
            # –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤—ã–±–æ—Ä—ã –Ω–∞ —ç—Ç–æ–º —ç–∫—Ä–∞–Ω–µ
            state["selections"] = [sel for sel in state["selections"] if sel.get("screen_id") != screen_id]

        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –≤—ã–±–æ—Ä
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º time.time() –¥–ª—è timestamp
        state["selections"].append({
            "screen_id": screen_id,
            "selected_item": selected_item,
            "timestamp": time.time()
        })

    def _build_static_actions(self, screen_def: Dict[str, Any]) -> List[Dict[str, Any]]:
        actions = []
        for i, btn in enumerate(screen_def["buttons"]):
            action_dict = {
                "id": f"static_{i}",
                "label": btn["label"],
            }
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ 'target' ‚Äî –µ—Å–ª–∏ –µ—Å—Ç—å, —Ç–æ —ç—Ç–æ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
            if "target" in btn:
                action_dict["type"] = "navigate"
                action_dict["target"] = btn["target"]
            # –ï—Å–ª–∏ 'target' –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å 'action' ‚Äî —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ
            elif "action" in btn:
                action_dict["type"] = "action"
                action_dict["action"] = btn["action"]
            # –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ 'target', –Ω–∏ 'action', —Å—Ç–∞–≤–∏–º 'unknown' –∏ –ª–æ–≥–∏—Ä—É–µ–º
            else:
                action_dict["type"] = "unknown"
                self.logger.log_error(f"–ö–Ω–æ–ø–∫–∞ –Ω–µ –∏–º–µ–µ—Ç –Ω–∏ 'target', –Ω–∏ 'action': {btn}")

            # –î–æ–±–∞–≤–ª—è–µ–º payload, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            if "payload" in btn:
                action_dict["payload"] = btn["payload"]

            actions.append(action_dict)
        return actions

    def _build_dynamic_actions(self, user_id: str, screen_def: Dict[str, Any], context: Dict[str, Any]) -> List[Dict[str, Any]]:
        url = self._render_template(screen_def["data_source"]["url"], context)
        self.logger.log_api_call(url, screen_def["data_source"]["method"])
        items = self.api_client.call(url, screen_def["data_source"]["method"])
        actions = []
        template = screen_def["button_template"]
        for i, item in enumerate(items):
            next_context = {}
            for ctx_key, item_key in template.get("context_fields", {}).items():
                next_context[ctx_key] = item.get(item_key, "")
            actions.append({
                "id": f"dynamic_{i}",
                "label": item.get(template["label_field"], f"Item {i}"),
                "type": "navigate",
                "target": template["target_screen"],
                "context": next_context
            })
        return actions

    def _build_paginated_actions(self, user_id: str, screen_def: Dict[str, Any], context: Dict[str, Any]) -> List[Dict[str, Any]]:
        items = screen_def["items"]
        page_size = self.manifest.defaults["pagination"]["page_size"]
        pagination_state = self._user_states[user_id]["pagination"]
        screen_id_key = screen_def.get("id", "unknown")
        current_page = pagination_state.get(screen_id_key, 0)
        start = current_page * page_size
        end = start + page_size
        page_items = items[start:end]
        actions = []
        for i, item in enumerate(page_items):
            actions.append({
                "id": f"paginated_{start + i}",
                "label": str(item),
                "type": "navigate",
                "target": screen_def.get("target", "item_selected"),
                "payload": str(item)
            })

        if end < len(items):
            actions.append({
                "id": "next_page",
                "label": self.manifest.defaults["pagination"]["next_label"],
                "type": "paginate",
                "direction": "next",
                "screen_id": screen_id_key
            })
        if current_page > 0:
            actions.append({
                "id": "prev_page",
                "label": self.manifest.defaults["pagination"]["prev_label"],
                "type": "paginate",
                "direction": "prev",
                "screen_id": screen_id_key
            })
        return actions

    def handle_action(self, user_id: str, action_data: Dict[str, Any]) -> Union[Dict[str, Any], None]: # <-- –í–æ—Ç —Ç—É—Ç-—Ç–æ –∏ –±—ã–ª–∞ –±–µ–¥–∞!
        state = self.get_user_state(user_id)
        action_type = action_data["type"]
        self.logger.log_user_action(user_id, "unknown", action_data["label"])
        if action_type == "back":
            self._handle_back(user_id, state)
        elif action_type == "navigate":
            self._handle_navigate(user_id, state, action_data)
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            # –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ navigate - —ç—Ç–æ –≤—ã–±–æ—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å target
            if "target" in action_data:
                self._record_selection(user_id, state["current_screen"], {"type": "navigate", "target": action_data["target"]})
        elif action_type == "paginate":
            self._handle_paginate(user_id, state, action_data)
        elif action_type == "action":
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä submit_mark
            if "action" in action_data: # <-- –ò—Å–ø—Ä–∞–≤–∏–ª–∞ –∏ —Ç—É—Ç action_data
                if action_data["action"] == "submit_mark":
                    self._submit_mark(user_id, state, action_data) # –õ–æ–≥–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤–Ω—É—Ç—Ä–∏
                    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è
                    self._record_selection(user_id, state["current_screen"], {"type": "action", "action": action_data["action"]})
                else:
                    self.logger.log_error(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: {action_data['action']}")
            else:
                self.logger.log_error(f"–î–µ–π—Å—Ç–≤–∏–µ –Ω–µ –∏–º–µ–µ—Ç –∫–ª—é—á–∞ 'action': {action_data}")
        else:
            self.logger.log_error(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è: {action_type}")

    def _handle_back(self, user_id: str, state: Dict[str, Any]):
        current_screen = state["current_screen"]
        screen_def = self.manifest.screens.get(current_screen)
        if not screen_def:
            state["current_screen"] = "main"
            return
        back_path = screen_def.get("back_path")
        if back_path == "CONTEXTUAL":
            if state["return_stack"]:
                state["current_screen"] = state["return_stack"].pop()
            else:
                state["current_screen"] = "main"
        elif back_path:
            state["current_screen"] = back_path
        else:
            state["current_screen"] = "main"

    def _handle_navigate(self, user_id: str, state: Dict[str, Any], action_data: Dict[str, Any]): # <-- –ò—Å–ø—Ä–∞–≤–∏–ª–∞ –∏ —Ç—É—Ç action_data
        target_screen = action_data["target"]
        if target_screen not in self.manifest.screens:
            self.logger.log_error(f"–¶–µ–ª–µ–≤–æ–π —ç–∫—Ä–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω: {target_screen}")
            return
        next_screen_def = self.manifest.screens.get(target_screen, {})
        if next_screen_def.get("back_path") == "CONTEXTUAL":
            state["return_stack"].append(state["current_screen"])
        state["current_screen"] = target_screen
        if "context" in action_data: # <-- –ò—Å–ø—Ä–∞–≤–∏–ª–∞ –∏ —Ç—É—Ç action_data
            state["context"].update(action_data["context"])

    def _handle_paginate(self, user_id: str, state: Dict[str, Any], action_data: Dict[str, Any]): # <-- –ò—Å–ø—Ä–∞–≤–∏–ª–∞ –∏ —Ç—É—Ç action_data
        screen_id = action_data["screen_id"]
        direction = action_data["direction"]
        pagination_state = state["pagination"]
        current_page = pagination_state.get(screen_id, 0)
        new_page = current_page + (1 if direction == "next" else -1)
        pagination_state[screen_id] = max(0, new_page)

    def _submit_mark(self, user_id: str, state: Dict[str, Any], action_data: Dict[str, Any]): # <-- –ò—Å–ø—Ä–∞–≤–∏–ª–∞ –∏ —Ç—É—Ç action_data
        # –õ–æ–≥–≥–∏—Ä—É–µ–º API –≤—ã–∑–æ–≤
        self.logger.log_api_call("/api/marks", "POST")
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, student_id, student_name)
        # –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∫ select_metric
        saved_context = {key: value for key, value in state["context"].items() if key in ["student_id", "student_name"]}
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–∫—Ä–∞–Ω –Ω–∞ 'select_metric' (—É–∫–∞–∑–∞–Ω –≤ back_path –¥–ª—è confirm_mark)
        screen_def = self.manifest.screens.get(state["current_screen"]) # –¢–µ–∫—É—â–∏–π —ç–∫—Ä–∞–Ω - confirm_mark
        back_path = screen_def.get("back_path") if screen_def else "main"
        if back_path == "select_metric": # –Ø–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –∫—É–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è
            state["current_screen"] = "select_metric"
            # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞
            state["context"].update(saved_context)
            # –û—á–∏—â–∞–µ–º return_stack, —Ç–∞–∫ –∫–∞–∫ –≤–æ–∑–≤—Ä–∞—Ç –Ω–µ –ø–æ –Ω–µ–º—É
            state["return_stack"] = []
        else:
            # –ï—Å–ª–∏ back_path –Ω–µ select_metric, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –ø–æ —Å—Ç–µ–∫—É –∏–ª–∏ –Ω–∞ main
            if state["return_stack"]:
                state["current_screen"] = state["return_stack"].pop()
            else:
                state["current_screen"] = "main"

    def handle_user_input(self, user_id: str, text: str):
        state = self.get_user_state(user_id)
        screen_id = state["current_screen"]
        screen_def = self.manifest.screens.get(screen_id)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —á–∞—Ç-—Ä–µ–∂–∏–º–µ
        if screen_def and screen_def.get("type") == "chat_input":
            self.logger.log_user_action(user_id, "user_input", f"¬´{text}¬ª")
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–∞–Ω–¥—ã finish
            finish_commands = self.manifest.defaults["chat_mode"]["finish_commands"]
            if text.strip() in finish_commands:
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ back_path
                back_path = screen_def.get("back_path", "main")
                state["current_screen"] = back_path
                # –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —á–∞—Ç–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
                # (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è, –µ—ë –º–æ–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å)
                # state["context"].pop("chat_history", None)
                return # –í—ã—Ö–æ–¥ –∏–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –≤ –≤—ã–∑—ã–≤–∞—é—â–µ–º –∫–æ–¥–µ

            # –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ AI
            # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç—É—Ç –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ API
            ai_response = f"–ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ AI –Ω–∞: {text}"
            # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç AI –º–æ–≥ –±—ã –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
            # –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ GUI.
            # –ù–∞–ø—Ä–∏–º–µ—Ä: state["context"]["last_ai_response"] = ai_response
            # –ò–ª–∏, –≤ GUI, —ç—Ç–æ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–æ –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞.
            # –ú—ã –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–≥–∏—Ä—É–µ–º –∏–º–∏—Ç–∞—Ü–∏—é.
            self.logger.log_api_call("/api/ai/teacher-assist", "POST")
            self.logger.logger.info(f"USER[{user_id}] AI_RESPONSE: {ai_response}")

        else:
            # –ï—Å–ª–∏ –Ω–µ –≤ —á–∞—Ç-—Ä–µ–∂–∏–º–µ, –º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å
            self.logger.log_user_action(user_id, "user_input_ignored", f"¬´{text}¬ª - not in chat mode")

navigation\logger.py
---
import logging
from typing import Optional

class NavigationLogger:
    def __init__(self, name: str = "NavigationEngine", level: int = logging.INFO, log_file: str = "navigation.log"):
        self.logger = logging.getLogger(name)
        self.logger.setLevel(level)
        if not self.logger.handlers:
            formatter = logging.Formatter(
                "[%(asctime)s] %(name)s :: %(levelname)s :: %(message)s",
                datefmt="%Y-%m-%d %H:%M:%S"
            )
            # –¢–æ–ª—å–∫–æ —Ñ–∞–π–ª ‚Äî –±–µ–∑ –∫–æ–Ω—Å–æ–ª–∏
            file_handler = logging.FileHandler(log_file, encoding="utf-8")
            file_handler.setFormatter(formatter)
            self.logger.addHandler(file_handler)

    def log_view_rendered(self, user_id: str, screen_id: str, text: str):
        self.logger.info(f"USER[{user_id}] VIEW[{screen_id}]: {text[:60]}...")

    def log_user_action(self, user_id: str, action_id: str, label: str):
        self.logger.info(f"USER[{user_id}] ACTION: '{label}' (id={action_id})")

    def log_api_call(self, url: str, method: str):
        self.logger.debug(f"API CALL: {method} {url}")

    def log_error(self, message: str):
        self.logger.error(message)
navigation\manifest.py
---
import json
from typing import Dict, Any

class ManifestLoader:
    def __init__(self, manifest_path: str = "menu-manifest.json"):
        self.manifest_path = manifest_path
        self.data = self._load()

    def _load(self) -> Dict[str, Any]:
        try:
            with open(self.manifest_path, "r", encoding="utf-8") as f:
                data = json.load(f)
        except FileNotFoundError:
            raise FileNotFoundError(f"–ú–∞–Ω–∏—Ñ–µ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: {self.manifest_path}")
        except json.JSONDecodeError as e:
            raise ValueError(f"–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON: {e}")
        if "screens" not in data:
            raise ValueError("–ú–∞–Ω–∏—Ñ–µ—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 'screens'")
        if "defaults" not in data:
            data["defaults"] = {}
        return data

    @property
    def screens(self) -> Dict[str, Any]:
        return self.data["screens"]

    @property
    def defaults(self) -> Dict[str, Any]:
        return self.data["defaults"]
navigation\textual_ui.py
---
from textual.app import App, ComposeResult
from textual.widgets import Static, Button, Footer
from textual.containers import Vertical
from .engine import NavigationEngine

class NavigationTextualApp(App):
    CSS = """
    Vertical {
        align: center middle;
    }
    #title {
        text-align: center;
        margin: 2 0;
        color: $accent;
        text-style: bold;
    }
    Button {
        width: 40;
        margin: 1 0;
    }
    """

    def __init__(self):
        super().__init__()
        self.engine = NavigationEngine()
        self.user_id = "test-user"
        self.engine.init_user(self.user_id)

    def compose(self) -> ComposeResult:
        yield Static("", id="title")
        yield Vertical(id="buttons")
        yield Footer()

    def update_ui(self):
        view = self.engine.get_current_view(self.user_id)
        self.query_one("#title", Static).update(view["text"])
        buttons_container = self.query_one("#buttons", Vertical)
        buttons_container.remove_children()
        self._buttons = []
        for action in view["actions"]:
            # –ù–ï–¢ id ‚Äî Textual —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å—é
            btn = Button(action["label"])
            btn.action_data = action
            buttons_container.mount(btn)
            self._buttons.append(btn)
        if self._buttons:
            self.set_focus(self._buttons[0])

    def on_mount(self):
        self.update_ui()

    def on_button_pressed(self, event: Button.Pressed):
        action_data = event.button.action_data
        # ‚úÖ –ü–µ—Ä–µ–¥–∞—ë–º —Ç–æ–ª—å–∫–æ user_id –∏ action_data
        self.engine.handle_action(self.user_id, action_data)
        self.update_ui()

if __name__ == "__main__":
    NavigationTextualApp().run()
navigation\__init__.py
---

